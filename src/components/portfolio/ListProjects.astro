---
import Project from "./Project.astro";
const allGames = await Astro.glob("../../pages/projects/games/*.md");
// Sort by descending date (most recent first)
allGames.sort(
    (a, b) =>
        new Date(b.frontmatter.pubDate).getTime() -
        new Date(a.frontmatter.pubDate).getTime(),
);

const allMovies = await Astro.glob("../../pages/projects/movies/*.md");
// Sort by descending date (most recent first)
allMovies.sort(
    (a, b) =>
        new Date(b.frontmatter.pubDate).getTime() -
        new Date(a.frontmatter.pubDate).getTime(),
);
---

<section class="relative pt-8 pb-32 max-2xl:px-8 max-md:pt-4">
    <div class="mx-auto max-w-7xl py-8">
        <slot />
    </div>

    <div
        id="containerProjects"
        class="mx-auto max-w-7xl grid grid-cols-3 max-lg:grid-cols-2 max-sm:grid-cols-1 auto-rows-fr gap-5 p-2 py-4 overflow-hidden transition-[max-height] duration-500 ease-in-out"
    >
        {
            [...allGames, ...allMovies].map((post) => (
                <Project
                    url={post.url}
                    title={post.frontmatter.title}
                    description={post.frontmatter.description}
                    date={post.frontmatter.pubDate}
                    languages={post.frontmatter.languages}
                    image={post.frontmatter.image}
                />
            ))
        }
    </div>
</section>

<script>
    document.querySelector("#moreProjects")?.addEventListener("click", () => {
        const contenedor = document.querySelector(
            "#containerProjects",
        ) as HTMLElement;
        const moreprojects = document.querySelector("#moreProjects");

        if (contenedor && moreprojects) {
            // Use a very large max height to show all content
            contenedor.style.maxHeight = "15000px";
            // Hide the view more button
            setTimeout(() => {
                moreprojects.classList.add("hidden");
            }, 5000);
        }
    });
</script>
